<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Version: 1.0.1 -->
  <title>Instagram Fake Followers Detector</title>
  <!-- Defer non-critical CSS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">
  <!-- Load critical CSS inline -->
  <style>
    * {
      font-family: "Comic Neue", serif !important;
    }

    body {
      font-weight: 400;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      margin: 0;
      min-height: 100vh;
      background-color: #111;
      padding: 1em;
    }

    .codeBox__wrapper {
      display: flex;
      max-width: 680px;
      width: 100%;
      flex-direction: column;
      gap: 2em;
      align-items: center;
    }

    code {
      font-weight: 800;
      user-select: none;
      pointer-events: none;
    }

    .codeBox {
      width: 100%;
      font-size: 10px;
      user-select: none;
      margin: 0 auto;
      margin-top: 20px;
    }

    .codeBox code {
      padding: 1em 0;
    }

    .copy-button {
      padding: 0.6em 1em;
      max-width: 320px;
      color: #FFFFFF;
      background-color: #222;
      border: none;
      border-radius: 1em;
      font-size: 2em;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5em;
      transition-duration: 500ms;
    }

    .copy-button:hover {
      background-color: #333;
    }

    .white {
      color: white;
    }

    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      width: 100%;
      max-width: 980px;
      gap: 2em;
      z-index: 1;
    }

    .container header {
      font-family: "Comic Neue", serif;
      font-weight: 700;
      font-style: italic;
      color: #FFFFFF;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: row;
      gap: 1em;
    }

    .logo-text {
      font-size: 2em;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .container header>.text {
      font-size: 2em;
      color: white;
    }

    /* Confirm Overlay */
    .confirm-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      color: #FFFFFF;
      justify-content: center;
      align-items: center;
      z-index: 100;
      pointer-events: none;
      opacity: 0;
      transition-duration: 100ms;
      background-color: #38d1d1;
    }

    .confirm-overlay.show {
      opacity: 1;
      pointer-events: all;
    }

    .confirm-box {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 2em;
    }

    .confirm-box__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-direction: row;
      gap: 1em;
    }

    .confirm-box__header__text {
      font-size: 2em;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .confirm-box__close {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: row;
      gap: 1em;
    }

    .confirm-box__close button {
      padding: 0.4em 1em;
      max-width: 320px;
      background-color: #FFFFFF;
      border: none;
      border-radius: 4px;
      font-size: 1.25em;
      color: #111111;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5em;
      transition-duration: 100ms;
    }

    .confirm-box__close button:hover {
      background-color: #F2F2F2;
    }

    .confirm-box__body {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 1em;
    }

    pre {
      border-radius: 1em;
      overflow: hidden !important;
    }

    .language-javascript {
      border: unset !important;
    }

    .instructions {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }

    .instructions h2 {
      color: #262626;
      margin-top: 0;
    }

    .instructions ol {
      padding-left: 20px;
    }

    .instructions li {
      margin-bottom: 10px;
    }

    .credit {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #dbdbdb;
      font-size: 14px;
      color: #8e8e8e;
    }

    .credit a {
      color: #0095f6;
      text-decoration: none;
    }

    .credit a:hover {
      text-decoration: underline;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .overlay-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }

    .close-button {
      background-color: #0095f6;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 15px;
    }

    .loading {
      color: #fff;
      text-align: center;
      padding: 20px;
    }

    .error-message {
      color: #ff4444;
      text-align: center;
      padding: 20px;
      display: none;
    }
  </style>
  <!-- Defer non-critical resources -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/prism.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/themes/prism-coy.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
  <div class="container">
    <div id="loading" class="loading">
      <i class="fas fa-spinner fa-spin"></i> Loading...
    </div>
    <div id="error" class="error-message">
      <i class="fas fa-exclamation-triangle"></i> Error loading resources. Please try refreshing the page.
    </div>
    <div id="content" style="display: none;">
      <header>
        <div class="logo-text">
          <i class="fas fa-user-shield white"></i>
          <span class="text">Instagram Fake Followers Detector</span>
        </div>
      </header>
      <div class="codeBox__wrapper">
        <div class="codeBox">
          <pre><code class="language-javascript" id="code"></code></pre>
        </div>
        <button class="copy-button" id="copyButton">
          <i class="fas fa-copy"></i>
          <span>Copy Code</span>
        </button>
      </div>
      <div class="instructions">
        <h2>üìù Usage Instructions</h2>
        <ol>
          <li>Log in to Instagram in your browser</li>
          <li>Go to the profile you want to analyze</li>
          <li>Open your browser's developer tools:
            <ul>
              <li>Windows/Linux: Press F12 or Ctrl+Shift+I</li>
              <li>Mac: Press Cmd+Option+I</li>
              <li>Or right-click and select "Inspect"</li>
            </ul>
          </li>
          <li>Go to the "Console" tab</li>
          <li>Copy and paste the code below</li>
          <li>Press Enter to run the analysis</li>
        </ol>
      </div>
      <div class="credit">
        <p>This project is an enhanced fork of <a href="https://github.com/davidarroyo1234/InstagramUnfollowers" target="_blank">InstagramUnfollowers</a> created by <a href="https://github.com/davidarroyo1234" target="_blank">@davidarroyo1234</a></p>
      </div>
    </div>
    <div class="confirm-overlay" id="confirmOverlay">
      <div class="confirm-box">
        <div class="confirm-box__header">
          <div class="confirm-box__header__text">
            <i class="fas fa-check"></i>
            <span>Code Copied!</span>
          </div>
          <div class="confirm-box__close">
            <button id="closeConfirm">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Handle resource loading errors
    window.addEventListener('error', function(e) {
      if (e.target.tagName === 'SCRIPT' || e.target.tagName === 'LINK') {
        document.getElementById('error').style.display = 'block';
        document.getElementById('loading').style.display = 'none';
      }
    });

    // Show content when everything is loaded
    window.addEventListener('load', function() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('content').style.display = 'block';
    });

    // Your existing JavaScript code
    const scriptLabel = document.getElementById("code");
    const instagramScript = `// Instagram Fake Followers Detector
// Ejecutar este c√≥digo en la consola del navegador mientras est√°s en un perfil de Instagram

(() => {
    // Verificar que estamos en Instagram y en un perfil
    if (location.hostname !== 'www.instagram.com') {
        alert('Esta herramienta solo puede usarse en Instagram');
        return;
    }

    // Obtener username de la URL actual
    const getCurrentUsername = () => {
        const path = window.location.pathname;
        if (!path.match(/^\\/[^\\/]+\\/?$/)) {
            alert('Por favor, ejecuta esta herramienta desde el perfil del usuario que quieres analizar\\nEjemplo: https://www.instagram.com/username/');
            return null;
        }
        return path.split('/')[1];
    };

    const username = getCurrentUsername();
    if (!username) return;

    // Configuraci√≥n por defecto
    let config = {
        maxPosts: 0,                      // M√°ximo n√∫mero de posts para considerar sospechoso
        minFollowers: 10,                 // M√≠nimo n√∫mero de seguidores para considerar sospechoso
        followersPerRequest: 50,          // Seguidores por solicitud
        cooldownBetweenProfiles: 2000,    // Tiempo entre an√°lisis de perfiles (ms)
        cooldownBetweenRequests: 1000,    // Tiempo entre solicitudes de seguidores (ms)
        retryDelay: 5000                  // Tiempo base para reintentos (ms)
    };

    // Variables globales
    let analysisResults = {
        fakeFollowers: [],
        suspiciousFollowers: [],
        totalFollowers: 0,
        analyzedCount: 0,
        lastUpdate: null,
        analyzedProfiles: new Set()       // Set para guardar perfiles ya analizados
    };

    // Variables de control
    let isPaused = false;
    let shouldStop = false;

    // Funci√≥n para esperar un tiempo determinado
    const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

    // Funci√≥n para hacer una petici√≥n con reintentos
    const fetchWithRetry = async (url, options = {}, maxRetries = 3) => {
        for (let i = 0; i < maxRetries; i++) {
            try {
                const response = await fetch(url, options);
                if (response.ok) return response;
                
                if (response.status === 429) {
                    const waitTime = (i + 1) * 5000; // 5s, 10s, 15s
                    console.log(\`Rate limit alcanzado. Esperando \${waitTime/1000} segundos...\`);
                    await wait(waitTime);
                    continue;
                }
                
                throw new Error(\`HTTP error! status: \${response.status}\`);
            } catch (error) {
                if (i === maxRetries - 1) throw error;
                await wait(2000); // Esperar 2s entre reintentos
            }
        }
    };

    // Funci√≥n para obtener ID del usuario
    const getUserId = async (username) => {
        try {
            const response = await fetchWithRetry(
                \`https://www.instagram.com/api/v1/users/web_profile_info/?username=\${username}\`,
                {
                    headers: {
                        'X-IG-App-ID': '936619743392459'
                    }
                }
            );
            const data = await response.json();
            return data.data.user.id;
        } catch (error) {
            console.error('Error al obtener ID:', error);
            throw error;
        }
    };

    // Funci√≥n para obtener todos los seguidores de una vez
    const getAllFollowers = async (userId) => {
        let followers = [];
        let hasNext = true;
        let endCursor = null;
        let totalCount = 0;
        let currentCount = 0;

        // Primero obtener el total de seguidores
        const initialResponse = await fetchWithRetry(
            \`https://www.instagram.com/graphql/query/?query_hash=c76146de99bb02f6415203be841dd25a&variables=\${encodeURIComponent(JSON.stringify({
                id: userId,
                first: 1
            }))}\`,
            {
                headers: {
                    'X-IG-App-ID': '936619743392459'
                }
            }
        );
        const initialData = await initialResponse.json();
        totalCount = initialData.data.user.edge_followed_by.count;

        while (hasNext) {
            const variables = {
                id: userId,
                first: config.followersPerRequest,
                after: endCursor
            };

            const response = await fetchWithRetry(
                \`https://www.instagram.com/graphql/query/?query_hash=c76146de99bb02f6415203be841dd25a&variables=\${encodeURIComponent(JSON.stringify(variables))}\`,
                {
                    headers: {
                        'X-IG-App-ID': '936619743392459'
                    }
                }
            );

            const data = await response.json();
            const edges = data.data.user.edge_followed_by.edges;
            followers = followers.concat(edges.map(edge => edge.node));
            
            currentCount += edges.length;
            const progress = (currentCount / totalCount) * 100;
            progressBar.style.width = \`\${33 * (progress / 100)}%\`;
            progressText.textContent = \`Obteniendo lista de seguidores... \${currentCount}/\${totalCount} (\${progress.toFixed(1)}%)\`;
            
            hasNext = data.data.user.edge_followed_by.page_info.has_next_page;
            endCursor = data.data.user.edge_followed_by.page_info.end_cursor;

            // Esperar 1 segundo entre solicitudes para evitar l√≠mites
            await wait(1000);
        }

        return followers;
    };

    // Funci√≥n para obtener todos los seguidos de una vez
    const getAllFollowing = async (userId) => {
        let following = [];
        let hasNext = true;
        let endCursor = null;

        while (hasNext) {
            const variables = {
                id: userId,
                first: config.followersPerRequest,
                after: endCursor
            };

            const response = await fetch(\`https://www.instagram.com/graphql/query/?query_hash=d04b0a864b4b54837c0d870b0e77e076&variables=\${encodeURIComponent(JSON.stringify(variables))}\`, {
                headers: {
                    'X-IG-App-ID': '936619743392459'
                }
            });

            const data = await response.json();
            const edges = data.data.user.edge_follow.edges;
            following = following.concat(edges.map(edge => edge.node));
            
            hasNext = data.data.user.edge_follow.page_info.has_next_page;
            endCursor = data.data.user.edge_follow.page_info.end_cursor;
        }

        return following;
    };

    // Funci√≥n para analizar un perfil
    const analyzeProfile = async (username) => {
        try {
            // Esperar 2 segundos entre cada an√°lisis de perfil
            await wait(2000);

            const response = await fetchWithRetry(
                \`https://www.instagram.com/api/v1/users/web_profile_info/?username=\${username}\`,
                {
                    headers: {
                        'X-IG-App-ID': '936619743392459'
                    }
                }
            );

            const data = await response.json();
            const user = data.data.user;
            
            return {
                username: user.username,
                full_name: user.full_name,
                posts: user.edge_owner_to_timeline_media.count,
                followers: user.edge_followed_by.count,
                following: user.edge_follow.count,
                isSuspicious: user.edge_owner_to_timeline_media.count <= config.maxPosts && 
                            user.edge_followed_by.count > config.minFollowers
            };
        } catch (error) {
            console.error(\`Error al analizar perfil \${username}:\`, error);
            return null;
        }
    };

    // Funci√≥n para guardar resultados localmente
    const saveResults = () => {
        const data = {
            username,
            config,
            results: {
                ...analysisResults,
                analyzedProfiles: Array.from(analysisResults.analyzedProfiles)
            },
            timestamp: new Date().toISOString()
        };
        localStorage.setItem(\`instagram_analyzer_\${username}\`, JSON.stringify(data));
    };

    // Funci√≥n para cargar resultados guardados
    const loadSavedResults = () => {
        const saved = localStorage.getItem(\`instagram_analyzer_\${username}\`);
        if (saved) {
            const data = JSON.parse(saved);
            config = data.config;
            analysisResults = {
                ...data.results,
                analyzedProfiles: new Set(data.results.analyzedProfiles)
            };
            return true;
        }
        return false;
    };

    // Crear la interfaz de usuario
    const createUI = () => {
        const container = document.createElement('div');
        container.style.cssText = \`
            position: fixed;
            top: 20px;
            right: 20px;
            width: 350px;
            background: #111;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            padding: 20px;
            z-index: 9999;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #fff;
            max-height: 80vh;
            overflow-y: auto;
        \`;

        container.innerHTML = \`
            <h2 style="margin-bottom: 15px; color: #fff;">Detector de Cuentas Sospechosas</h2>
            <div style="margin-bottom: 15px;">
                <div style="background: #222; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                    <p style="margin: 0; color: #fff;">Analizando perfil: <strong style="color: #0095f6;">@\${username}</strong></p>
                </div>
                <div style="margin-bottom: 10px;">
                    <button id="configBtn" style="width: 100%; padding: 8px; background: #333; color: white; border: none; border-radius: 4px; cursor: pointer; margin-bottom: 10px;">
                        ‚öôÔ∏è Configuraci√≥n Avanzada
                    </button>
                    <div id="configPanel" style="display: none; background: #222; padding: 15px; border-radius: 4px; margin-bottom: 10px;">
                        <h3 style="margin-bottom: 15px; color: #fff;">Configuraci√≥n</h3>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px; color: #fff;">M√°ximo posts para considerar sospechoso:</label>
                            <input type="number" id="maxPosts" value="\${config.maxPosts}" min="0" 
                                style="width: 100%; padding: 8px; background: #333; border: 1px solid #444; color: #fff; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px; color: #fff;">M√≠nimo seguidores para considerar sospechoso:</label>
                            <input type="number" id="minFollowers" value="\${config.minFollowers}" min="1" 
                                style="width: 100%; padding: 8px; background: #333; border: 1px solid #444; color: #fff; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px; color: #fff;">Tiempo entre an√°lisis de perfiles (ms):</label>
                            <input type="number" id="cooldownBetweenProfiles" value="\${config.cooldownBetweenProfiles}" min="1000" 
                                style="width: 100%; padding: 8px; background: #333; border: 1px solid #444; color: #fff; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px; color: #fff;">Tiempo entre solicitudes (ms):</label>
                            <input type="number" id="cooldownBetweenRequests" value="\${config.cooldownBetweenRequests}" min="500" 
                                style="width: 100%; padding: 8px; background: #333; border: 1px solid #444; color: #fff; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px; color: #fff;">Tiempo base para reintentos (ms):</label>
                            <input type="number" id="retryDelay" value="\${config.retryDelay}" min="2000" 
                                style="width: 100%; padding: 8px; background: #333; border: 1px solid #444; color: #fff; border-radius: 4px;">
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button id="saveConfigBtn" style="flex: 1; padding: 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                Guardar
                            </button>
                            <button id="cancelConfigBtn" style="flex: 1; padding: 8px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
                <div id="resumePanel" style="display: none; background: #222; padding: 15px; border-radius: 4px; margin-bottom: 10px;">
                    <h3 style="margin-bottom: 15px; color: #fff;">An√°lisis Anterior Encontrado</h3>
                    <p style="color: #fff; margin-bottom: 10px;">Se encontr√≥ un an√°lisis anterior de este perfil.</p>
                    <div style="display: flex; gap: 10px;">
                        <button id="resumeBtn" style="flex: 1; padding: 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            Reanudar An√°lisis
                        </button>
                        <button id="newAnalysisBtn" style="flex: 1; padding: 8px; background: #0095f6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            Nuevo An√°lisis
                        </button>
                    </div>
                </div>
                <button id="analyzeBtn" style="width: 100%; padding: 10px; background: #0095f6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    Comenzar An√°lisis
                </button>
            </div>
            <div id="progress" style="display: none;">
                <div style="width: 100%; height: 4px; background: #333; border-radius: 2px; margin: 10px 0;">
                    <div id="progressBar" style="width: 0%; height: 100%; background: #0095f6; border-radius: 2px; transition: width 0.3s;"></div>
                </div>
                <p id="progressText" style="text-align: center; margin: 5px 0;">Obteniendo datos...</p>
                <div id="controlButtons" style="display: none; margin-top: 10px; display: flex; gap: 10px;">
                    <button id="pauseBtn" style="flex: 1; padding: 8px; background: #ffd700; color: #000; border: none; border-radius: 4px; cursor: pointer;">
                        ‚è∏Ô∏è Pausar
                    </button>
                    <button id="stopBtn" style="flex: 1; padding: 8px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        ‚èπÔ∏è Detener
                    </button>
                </div>
            </div>
            <div id="results" style="display: none;">
                <div id="stats" style="margin-bottom: 15px;"></div>
                <div id="lists" style="display: flex; gap: 10px;">
                    <button id="exportBtn" style="flex: 1; padding: 8px; background: #0095f6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        üì• Exportar CSV
                    </button>
                </div>
                <div id="suspiciousFollowers" style="margin-top: 15px;">
                    <h4 style="color: #fff; margin-bottom: 10px;">Cuentas Sospechosas:</h4>
                    <div id="suspiciousFollowersList" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
            </div>
        \`;

        document.body.appendChild(container);
        
        // Event listeners
        document.getElementById('configBtn').addEventListener('click', () => {
            const panel = document.getElementById('configPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        });

        document.getElementById('saveConfigBtn').addEventListener('click', () => {
            config = {
                maxPosts: parseInt(document.getElementById('maxPosts').value) || 0,
                minFollowers: parseInt(document.getElementById('minFollowers').value) || 10,
                cooldownBetweenProfiles: parseInt(document.getElementById('cooldownBetweenProfiles').value) || 2000,
                cooldownBetweenRequests: parseInt(document.getElementById('cooldownBetweenRequests').value) || 1000,
                retryDelay: parseInt(document.getElementById('retryDelay').value) || 5000,
                followersPerRequest: 50
            };
            document.getElementById('configPanel').style.display = 'none';
            saveResults();
        });

        document.getElementById('cancelConfigBtn').addEventListener('click', () => {
            document.getElementById('configPanel').style.display = 'none';
        });

        document.getElementById('analyzeBtn').addEventListener('click', () => {
            if (loadSavedResults()) {
                document.getElementById('resumePanel').style.display = 'block';
                document.getElementById('analyzeBtn').style.display = 'none';
            } else {
                analyzeAccount();
            }
        });

        document.getElementById('resumeBtn').addEventListener('click', () => {
            document.getElementById('resumePanel').style.display = 'none';
            document.getElementById('analyzeBtn').style.display = 'block';
            analyzeAccount(true);
        });

        document.getElementById('newAnalysisBtn').addEventListener('click', () => {
            document.getElementById('resumePanel').style.display = 'none';
            document.getElementById('analyzeBtn').style.display = 'block';
            localStorage.removeItem(\`instagram_analyzer_\${username}\`);
            analyzeAccount();
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            isPaused = !isPaused;
            const pauseBtn = document.getElementById('pauseBtn');
            pauseBtn.textContent = isPaused ? '‚ñ∂Ô∏è Reanudar' : '‚è∏Ô∏è Pausar';
            pauseBtn.style.background = isPaused ? '#28a745' : '#ffd700';
        });
        document.getElementById('stopBtn').addEventListener('click', () => {
            shouldStop = true;
            isPaused = false;
            document.getElementById('controlButtons').style.display = 'none';
            document.getElementById('exportBtn').style.display = 'block';
            document.getElementById('analyzeBtn').disabled = false;
        });
        document.getElementById('exportBtn').addEventListener('click', () => {
            if (analysisResults.suspiciousFollowers.length === 0) {
                alert('No hay datos para exportar');
                return;
            }
            const filename = \`cuentas_sospechosas_\${username}_\${new Date().toISOString().split('T')[0]}.csv\`;
            downloadCSV(analysisResults.suspiciousFollowers, filename);
        });
    };

    // Funci√≥n para convertir datos a CSV
    const convertToCSV = (data) => {
        const header = ['username', 'posts', 'followers'];
        const rows = data.map(item => [
            item.username,
            item.posts,
            item.followers
        ]);
        return [header, ...rows]
            .map(row => row.join(','))
            .join('\\n');
    };

    // Funci√≥n para descargar CSV
    const downloadCSV = (data, filename) => {
        const csv = convertToCSV(data);
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        if (navigator.msSaveBlob) {
            navigator.msSaveBlob(blob, filename);
        } else {
            link.href = URL.createObjectURL(blob);
            link.setAttribute('download', filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    };

    // Funci√≥n principal de an√°lisis modificada
    const analyzeAccount = async (isResume = false) => {
        // Actualizar configuraci√≥n
        config.maxPosts = parseInt(document.getElementById('maxPosts').value) || 0;
        config.minFollowers = parseInt(document.getElementById('minFollowers').value) || 10;

        const progress = document.getElementById('progress');
        const results = document.getElementById('results');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const controlButtons = document.getElementById('controlButtons');
        const exportBtn = document.getElementById('exportBtn');
        
        progress.style.display = 'block';
        results.style.display = 'none';
        analyzeBtn.disabled = true;
        controlButtons.style.display = 'none';
        exportBtn.style.display = 'none';
        
        // Reiniciar variables de control
        isPaused = false;
        shouldStop = false;
        
        try {
            // Obtener ID del usuario
            progressText.textContent = 'Obteniendo ID del usuario...';
            const userId = await getUserId(username);

            // Obtener todos los seguidores
            progressText.textContent = 'Obteniendo lista de seguidores...';
            progressBar.style.width = '0%';
            const followers = await getAllFollowers(userId);
            
            // Analizar cada seguidor
            progressText.textContent = 'Analizando perfiles...';
            progressBar.style.width = '33%';
            controlButtons.style.display = 'flex';
            
            const suspiciousFollowers = isResume ? [...analysisResults.suspiciousFollowers] : [];
            for (let i = 0; i < followers.length; i++) {
                if (shouldStop) break;
                
                while (isPaused) {
                    await wait(1000);
                }
                
                const follower = followers[i];
                
                // Si es un reanudar y ya analizamos este perfil, saltarlo
                if (isResume && analysisResults.analyzedProfiles.has(follower.username)) {
                    const progress = ((i + 1) / followers.length) * 100;
                    progressBar.style.width = \`\${33 + (progress * 0.67)}%\`;
                    progressText.textContent = \`Analizando perfiles... \${i + 1}/\${followers.length} (\${progress.toFixed(1)}%)\`;
                    continue;
                }
                
                const profileData = await analyzeProfile(follower.username);
                if (profileData) {
                    analysisResults.analyzedProfiles.add(follower.username);
                    if (profileData.isSuspicious) {
                        suspiciousFollowers.push(profileData);
                    }
                }
                
                // Actualizar progreso
                const progress = ((i + 1) / followers.length) * 100;
                progressBar.style.width = \`\${33 + (progress * 0.67)}%\`;
                progressText.textContent = \`Analizando perfiles... \${i + 1}/\${followers.length} (\${progress.toFixed(1)}%)\`;
            }

            // Actualizar resultados
            analysisResults = {
                suspiciousFollowers,
                totalFollowers: followers.length,
                analyzedCount: followers.length,
                lastUpdate: new Date().toISOString(),
                analyzedProfiles: analysisResults.analyzedProfiles
            };

            // Guardar resultados
            saveResults();

            // Mostrar resultados
            const stats = document.getElementById('stats');
            const suspiciousFollowersList = document.getElementById('suspiciousFollowersList');

            stats.innerHTML = \`
                <p>Total de Seguidores: \${followers.length}</p>
                <p>Cuentas Sospechosas Encontradas: \${suspiciousFollowers.length}</p>
                <p>Porcentaje de Cuentas Sospechosas: \${((suspiciousFollowers.length / followers.length) * 100).toFixed(1)}%</p>
            \`;

            suspiciousFollowersList.innerHTML = suspiciousFollowers.map(user => \`
                <div style="padding: 10px; border-bottom: 1px solid #333; display: flex; justify-content: space-between;">
                    <div>
                        <a href="https://instagram.com/\${user.username}" target="_blank" style="color: #0095f6; text-decoration: none;">
                            @\${user.username}
                        </a>
                    </div>
                    <div style="color: #999;">
                        \${user.posts} posts ¬∑ \${user.followers} seguidores
                    </div>
                </div>
            \`).join('');

            progress.style.display = 'none';
            results.style.display = 'block';

        } catch (error) {
            console.error('Error en el an√°lisis:', error);
            alert('Error al analizar la cuenta. Por favor intenta de nuevo.');
        } finally {
            analyzeBtn.disabled = false;
            controlButtons.style.display = 'none';
            exportBtn.style.display = 'block';
        }
    };

    // Inicializar la interfaz
    createUI();
})();`;

    async function copyToClipboard() {
      if (typeof instagramScript !== "undefined") {
        try {
          await navigator.clipboard.writeText(instagramScript);
          document.getElementById('confirmOverlay').style.display = 'flex';
        } catch (error) {
          console.error("Error copying text: ", error);
        }
      }
    }

    function closeOverlay() {
      document.getElementById('confirmOverlay').style.display = 'none';
    }

    // Initialize the code display
    document.getElementById('code').textContent = instagramScript;
  </script>
</body>

</html> 